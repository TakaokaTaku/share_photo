<%= form_with(model: @post, remote: true) do |f| %>
<%= render 'shared/error_messages', object: f.object %>
  <div class=" preview">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-header-content">
            <div class="icon">
              <%= icon(@user, 80) %>
              <h4>
                <%= link_to @user.name, @user %>
              </h4>
            </div>
          </div>
          <div class="preview-content">
            <%= f.text_area :content, placeholder: "投稿内容を記入してください..." %>
          </div>
        </div>
        <div class="modal-body">
          <span class="image">
            <%= f.label :image, "写真添付" %>
            <%= f.file_field :image, accept: "image/jpeg,image/png", id: 'post-img' %>
            <img id="img-preview" src="#" class='hidden' />
            <div class="default-preview">
              <%= image_tag 'camera.svg' %>
            </div>
          </span>
        </div>
        <div class="modal-footer">
        <div class="btn-box col-md-8">
          <%= f.submit "投稿", class: "btn btn-primary btn-lg",
                data: { confirm: "投稿の内容に間違いはありませんか？" } %>
        </div>
        <div class="btn-box col-md-4">
          <%= f.submit "リセット", type: :reset ,class: "reset btn btn-lg btn-warning" %>
        </div>
      </div>
      </div>
    </div>
  </div>
<% end %>



<script type="text/javascript">
  $("#post_image").bind("change", function() {
    var size_in_megabytes = this.files[0].size/1024/1024;
    if (size_in_megabytes > 5) {
      alert("Maximum file size is 5MB. Please choose a smaller file.");
      $("#post_image").val("");
    }
  });

  $( document ).on('turbolinks:load', function() {
  function readURL(input) {
    if (input.files && input.files[0]) {
      var reader = new FileReader();
      reader.onload = function (e) {
        $('#img-preview').attr('src', e.target.result);
      }
      reader.readAsDataURL(input.files[0]);
    }
  }
  $("#post-img").change(function(){
    $('#img-preview').removeClass('hidden');
    $('.default-preview').addClass('hidden');
    readURL(this);
  });
  $(".reset").click(function(){
    $('#img-preview').addClass('hidden');
    $('.default-preview').removeClass('hidden');
    readURL(this);
  });
});
</script>
